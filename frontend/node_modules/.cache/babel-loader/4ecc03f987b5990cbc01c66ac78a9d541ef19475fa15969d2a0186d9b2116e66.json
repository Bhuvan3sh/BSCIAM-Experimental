{"ast":null,"code":"import React,{useState,useEffect}from'react';import FileUpload from'./FileUpload';import FileList from'./FileList';import{PlusIcon}from'@heroicons/react/24/outline';import{useWallet}from'../../context/WalletContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FileManager=_ref=>{let{walletAddress}=_ref;const{getStoredFiles,storeFile,deleteStoredFile}=useWallet();const[files,setFiles]=useState([]);const[isUploading,setIsUploading]=useState(false);const[showUploadModal,setShowUploadModal]=useState(false);// Load user's files on component mount and when wallet address changes\nuseEffect(()=>{if(walletAddress){const userFiles=getStoredFiles();setFiles(userFiles);}else{setFiles([]);}},[walletAddress,getStoredFiles]);const handleFileUpload=async(file,encryptedData,key)=>{if(!walletAddress)return;setIsUploading(true);try{const newFile={id:Date.now().toString(),name:file.name,type:file.type,size:file.size,uploadedAt:new Date().toISOString(),encryptedData:encryptedData.encryptedData,metadata:{name:file.name,originalName:file.name,type:file.type,mimeType:file.type,size:file.size,lastModified:file.lastModified}};// Store the file using the wallet context\nstoreFile(newFile);// Update local state\nsetFiles(prevFiles=>[...prevFiles,newFile]);// Close the upload modal\nsetShowUploadModal(false);}catch(error){console.error('File upload failed:',error);throw error;}finally{setIsUploading(false);}};const handleDeleteFile=async fileId=>{if(!walletAddress)return;if(!window.confirm('Are you sure you want to delete this file? This action cannot be undone.')){return;}try{// Delete the file using the wallet context\ndeleteStoredFile(fileId);// Update local state\nsetFiles(prevFiles=>prevFiles.filter(file=>file.id!==fileId));}catch(error){console.error('Failed to delete file:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"My Files\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowUploadModal(true),className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"-ml-1 mr-2 h-5 w-5\"}),\"Upload File\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow rounded-lg p-6\",children:/*#__PURE__*/_jsx(FileList,{files:files,onDelete:handleDeleteFile})}),showUploadModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed z-10 inset-0 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 transition-opacity\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-gray-500 opacity-75\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"sm:flex sm:items-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-gray-900 mb-4\",children:\"Upload File\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(FileUpload,{onUpload:handleFileUpload,isUploading:isUploading})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowUploadModal(false),className:\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\",disabled:isUploading,children:\"Close\"})})]})]})})]});};export default FileManager;","map":{"version":3,"names":["React","useState","useEffect","FileUpload","FileList","PlusIcon","useWallet","jsx","_jsx","jsxs","_jsxs","FileManager","_ref","walletAddress","getStoredFiles","storeFile","deleteStoredFile","files","setFiles","isUploading","setIsUploading","showUploadModal","setShowUploadModal","userFiles","handleFileUpload","file","encryptedData","key","newFile","id","Date","now","toString","name","type","size","uploadedAt","toISOString","metadata","originalName","mimeType","lastModified","prevFiles","error","console","handleDeleteFile","fileId","window","confirm","filter","className","children","onClick","onDelete","onUpload","disabled"],"sources":["F:/Final Year Project/Project Implementation/frontend/src/components/files/FileManager.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport FileUpload from './FileUpload';\nimport FileList from './FileList';\nimport { StoredFile } from '../../types';\nimport { PlusIcon } from '@heroicons/react/24/outline';\nimport { useWallet } from '../../context/WalletContext';\n\ninterface FileManagerProps {\n  walletAddress: string;\n}\n\nconst FileManager: React.FC<FileManagerProps> = ({ walletAddress }) => {\n  const { getStoredFiles, storeFile, deleteStoredFile } = useWallet();\n  const [files, setFiles] = useState<StoredFile[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [showUploadModal, setShowUploadModal] = useState(false);\n\n  // Load user's files on component mount and when wallet address changes\n  useEffect(() => {\n    if (walletAddress) {\n      const userFiles = getStoredFiles();\n      setFiles(userFiles);\n    } else {\n      setFiles([]);\n    }\n  }, [walletAddress, getStoredFiles]);\n\n  const handleFileUpload = async (file: File, encryptedData: any, key: string) => {\n    if (!walletAddress) return;\n    \n    setIsUploading(true);\n    \n    try {\n      const newFile: StoredFile = {\n        id: Date.now().toString(),\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        uploadedAt: new Date().toISOString(),\n        encryptedData: encryptedData.encryptedData,\n        metadata: {\n          name: file.name,\n          originalName: file.name,\n          type: file.type,\n          mimeType: file.type,\n          size: file.size,\n          lastModified: file.lastModified\n        }\n      };\n      \n      // Store the file using the wallet context\n      storeFile(newFile);\n      \n      // Update local state\n      setFiles(prevFiles => [...prevFiles, newFile]);\n      \n      // Close the upload modal\n      setShowUploadModal(false);\n      \n    } catch (error) {\n      console.error('File upload failed:', error);\n      throw error;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleDeleteFile = async (fileId: string) => {\n    if (!walletAddress) return;\n    \n    if (!window.confirm('Are you sure you want to delete this file? This action cannot be undone.')) {\n      return;\n    }\n    \n    try {\n      // Delete the file using the wallet context\n      deleteStoredFile(fileId);\n      \n      // Update local state\n      setFiles(prevFiles => prevFiles.filter(file => file.id !== fileId));\n      \n    } catch (error) {\n      console.error('Failed to delete file:', error);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">My Files</h2>\n        <button\n          type=\"button\"\n          onClick={() => setShowUploadModal(true)}\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n        >\n          <PlusIcon className=\"-ml-1 mr-2 h-5 w-5\" />\n          Upload File\n        </button>\n      </div>\n\n      <div className=\"bg-white shadow rounded-lg p-6\">\n        <FileList \n          files={files} \n          onDelete={handleDeleteFile} \n        />\n      </div>\n\n      {/* Upload Modal */}\n      {showUploadModal && (\n        <div className=\"fixed z-10 inset-0 overflow-y-auto\">\n          <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\n            <div className=\"fixed inset-0 transition-opacity\" aria-hidden=\"true\">\n              <div className=\"absolute inset-0 bg-gray-500 opacity-75\"></div>\n            </div>\n\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">\n              &#8203;\n            </span>\n\n            <div className=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full\">\n              <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\n                <div className=\"sm:flex sm:items-start\">\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full\">\n                    <h3 className=\"text-lg leading-6 font-medium text-gray-900 mb-4\">\n                      Upload File\n                    </h3>\n                    <div className=\"mt-2\">\n                      <FileUpload \n                        onUpload={handleFileUpload} \n                        isUploading={isUploading} \n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div className=\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowUploadModal(false)}\n                  className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\"\n                  disabled={isUploading}\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FileManager;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}