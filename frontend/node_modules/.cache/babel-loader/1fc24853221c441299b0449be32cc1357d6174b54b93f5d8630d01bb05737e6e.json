{"ast":null,"code":"import React,{useState,useEffect}from'react';import FileUpload from'./FileUpload';import FileList from'./FileList';import{PlusIcon}from'@heroicons/react/24/outline';import{toast}from'react-hot-toast';import{useWallet}from'../../context/WalletContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FileManager=_ref=>{let{walletAddress}=_ref;const{getStoredFiles,storeFile,deleteStoredFile}=useWallet();const[files,setFiles]=useState([]);const[isUploading,setIsUploading]=useState(false);const[showUploadModal,setShowUploadModal]=useState(false);// Load user's files on component mount and when wallet address changes\nuseEffect(()=>{const loadFiles=async()=>{try{if(walletAddress){const userFiles=getStoredFiles();console.log('Loaded user files:',userFiles);setFiles(userFiles);}else{setFiles([]);}}catch(error){console.error('Error loading files:',error);setFiles([]);}};loadFiles();},[walletAddress,getStoredFiles]);const handleFileUpload=async(file,encryptedData,key)=>{if(!walletAddress){throw new Error('No wallet connected');}if(!encryptedData||!encryptedData.encryptedData){throw new Error('No encrypted data received');}setIsUploading(true);try{// Create the file object\nconst newFile={id:crypto.randomUUID(),name:file.name,type:file.type,size:file.size,uploadedAt:new Date().toISOString(),encryptedData:encryptedData.encryptedData,metadata:{name:file.name,originalName:file.name,type:file.type,mimeType:file.type,size:file.size,lastModified:file.lastModified,// Store the encryption key reference in metadata\nkey:key// Store the key reference in metadata\n}};console.log('Storing new file:',newFile);// Store the file using the wallet context\nconst updatedFiles=storeFile(newFile);// Update local state\nsetFiles(updatedFiles);// Close the upload modal\nsetShowUploadModal(false);toast.success('File uploaded successfully!');return newFile;}catch(error){console.error('File upload failed:',error);throw error;}finally{setIsUploading(false);}};const handleDeleteFile=async fileId=>{if(!walletAddress)return;if(!window.confirm('Are you sure you want to delete this file? This action cannot be undone.')){return;}try{// Delete the file using the wallet context\ndeleteStoredFile(fileId);// Update local state\nsetFiles(prevFiles=>prevFiles.filter(file=>file.id!==fileId));}catch(error){console.error('Failed to delete file:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white\",children:\"My Files\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setShowUploadModal(true),className:\"btn-primary\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"-ml-1 mr-2 h-5 w-5\"}),\"Upload File\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(FileList,{files:files,onDelete:handleDeleteFile})}),showUploadModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed z-10 inset-0 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 transition-opacity\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black opacity-75\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"inline-block align-bottom bg-dark-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-dark-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-dark-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"sm:flex sm:items-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg leading-6 font-medium text-white mb-4\",children:\"Upload File\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(FileUpload,{onUpload:handleFileUpload,isUploading:isUploading})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-dark-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowUploadModal(false),className:\"btn-secondary\",disabled:isUploading,children:\"Close\"})})]})]})})]});};export default FileManager;","map":{"version":3,"names":["React","useState","useEffect","FileUpload","FileList","PlusIcon","toast","useWallet","jsx","_jsx","jsxs","_jsxs","FileManager","_ref","walletAddress","getStoredFiles","storeFile","deleteStoredFile","files","setFiles","isUploading","setIsUploading","showUploadModal","setShowUploadModal","loadFiles","userFiles","console","log","error","handleFileUpload","file","encryptedData","key","Error","newFile","id","crypto","randomUUID","name","type","size","uploadedAt","Date","toISOString","metadata","originalName","mimeType","lastModified","updatedFiles","success","handleDeleteFile","fileId","window","confirm","prevFiles","filter","className","children","onClick","onDelete","onUpload","disabled"],"sources":["F:/Final Year Project/Project Implementation/frontend/src/components/files/FileManager.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport FileUpload from './FileUpload';\nimport FileList from './FileList';\nimport { StoredFile } from '../../types';\nimport { PlusIcon } from '@heroicons/react/24/outline';\nimport { toast } from 'react-hot-toast';\nimport { useWallet } from '../../context/WalletContext';\n\ninterface FileManagerProps {\n  walletAddress: string;\n}\n\nconst FileManager: React.FC<FileManagerProps> = ({ walletAddress }) => {\n  const { getStoredFiles, storeFile, deleteStoredFile } = useWallet();\n  const [files, setFiles] = useState<StoredFile[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [showUploadModal, setShowUploadModal] = useState(false);\n\n  // Load user's files on component mount and when wallet address changes\n  useEffect(() => {\n    const loadFiles = async () => {\n      try {\n        if (walletAddress) {\n          const userFiles = getStoredFiles();\n          console.log('Loaded user files:', userFiles);\n          setFiles(userFiles);\n        } else {\n          setFiles([]);\n        }\n      } catch (error) {\n        console.error('Error loading files:', error);\n        setFiles([]);\n      }\n    };\n\n    loadFiles();\n  }, [walletAddress, getStoredFiles]);\n\n  const handleFileUpload = async (file: File, encryptedData: any, key: string): Promise<StoredFile | void> => {\n    if (!walletAddress) {\n      throw new Error('No wallet connected');\n    }\n    \n    if (!encryptedData || !encryptedData.encryptedData) {\n      throw new Error('No encrypted data received');\n    }\n    \n    setIsUploading(true);\n    \n    try {\n      // Create the file object\n      const newFile: StoredFile = {\n        id: crypto.randomUUID(),\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        uploadedAt: new Date().toISOString(),\n        encryptedData: encryptedData.encryptedData,\n        metadata: {\n          name: file.name,\n          originalName: file.name,\n          type: file.type,\n          mimeType: file.type,\n          size: file.size,\n          lastModified: file.lastModified,\n          // Store the encryption key reference in metadata\n          key: key // Store the key reference in metadata\n        }\n      };\n      \n      console.log('Storing new file:', newFile);\n      \n      // Store the file using the wallet context\n      const updatedFiles = storeFile(newFile);\n      \n      // Update local state\n      setFiles(updatedFiles);\n      \n      // Close the upload modal\n      setShowUploadModal(false);\n      \n      toast.success('File uploaded successfully!');\n      return newFile;\n    } catch (error) {\n      console.error('File upload failed:', error);\n      throw error;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleDeleteFile = async (fileId: string) => {\n    if (!walletAddress) return;\n    \n    if (!window.confirm('Are you sure you want to delete this file? This action cannot be undone.')) {\n      return;\n    }\n    \n    try {\n      // Delete the file using the wallet context\n      deleteStoredFile(fileId);\n      \n      // Update local state\n      setFiles(prevFiles => prevFiles.filter(file => file.id !== fileId));\n      \n    } catch (error) {\n      console.error('Failed to delete file:', error);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-white\">My Files</h2>\n        <button\n          type=\"button\"\n          onClick={() => setShowUploadModal(true)}\n          className=\"btn-primary\"\n        >\n          <PlusIcon className=\"-ml-1 mr-2 h-5 w-5\" />\n          Upload File\n        </button>\n      </div>\n\n      <div className=\"card\">\n        <FileList \n          files={files} \n          onDelete={handleDeleteFile} \n        />\n      </div>\n\n      {/* Upload Modal */}\n      {showUploadModal && (\n        <div className=\"fixed z-10 inset-0 overflow-y-auto\">\n          <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\n            <div className=\"fixed inset-0 transition-opacity\" aria-hidden=\"true\">\n              <div className=\"absolute inset-0 bg-black opacity-75\"></div>\n            </div>\n\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">\n              &#8203;\n            </span>\n\n            <div className=\"inline-block align-bottom bg-dark-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-dark-700\">\n              <div className=\"bg-dark-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\n                <div className=\"sm:flex sm:items-start\">\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full\">\n                    <h3 className=\"text-lg leading-6 font-medium text-white mb-4\">\n                      Upload File\n                    </h3>\n                    <div className=\"mt-2\">\n                      <FileUpload \n                        onUpload={handleFileUpload} \n                        isUploading={isUploading} \n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div className=\"bg-dark-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowUploadModal(false)}\n                  className=\"btn-secondary\"\n                  disabled={isUploading}\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FileManager;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,UAAU,KAAM,cAAc,CACrC,MAAO,CAAAC,QAAQ,KAAM,YAAY,CAEjC,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,KAAK,KAAQ,iBAAiB,CACvC,OAASC,SAAS,KAAQ,6BAA6B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAMxD,KAAM,CAAAC,WAAuC,CAAGC,IAAA,EAAuB,IAAtB,CAAEC,aAAc,CAAC,CAAAD,IAAA,CAChE,KAAM,CAAEE,cAAc,CAAEC,SAAS,CAAEC,gBAAiB,CAAC,CAAGV,SAAS,CAAC,CAAC,CACnE,KAAM,CAACW,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAe,EAAE,CAAC,CACpD,KAAM,CAACmB,WAAW,CAAEC,cAAc,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACqB,eAAe,CAAEC,kBAAkB,CAAC,CAAGtB,QAAQ,CAAC,KAAK,CAAC,CAE7D;AACAC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsB,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,GAAI,CACF,GAAIV,aAAa,CAAE,CACjB,KAAM,CAAAW,SAAS,CAAGV,cAAc,CAAC,CAAC,CAClCW,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAEF,SAAS,CAAC,CAC5CN,QAAQ,CAACM,SAAS,CAAC,CACrB,CAAC,IAAM,CACLN,QAAQ,CAAC,EAAE,CAAC,CACd,CACF,CAAE,MAAOS,KAAK,CAAE,CACdF,OAAO,CAACE,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAAC,CAC5CT,QAAQ,CAAC,EAAE,CAAC,CACd,CACF,CAAC,CAEDK,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAACV,aAAa,CAAEC,cAAc,CAAC,CAAC,CAEnC,KAAM,CAAAc,gBAAgB,CAAG,KAAAA,CAAOC,IAAU,CAAEC,aAAkB,CAAEC,GAAW,GAAiC,CAC1G,GAAI,CAAClB,aAAa,CAAE,CAClB,KAAM,IAAI,CAAAmB,KAAK,CAAC,qBAAqB,CAAC,CACxC,CAEA,GAAI,CAACF,aAAa,EAAI,CAACA,aAAa,CAACA,aAAa,CAAE,CAClD,KAAM,IAAI,CAAAE,KAAK,CAAC,4BAA4B,CAAC,CAC/C,CAEAZ,cAAc,CAAC,IAAI,CAAC,CAEpB,GAAI,CACF;AACA,KAAM,CAAAa,OAAmB,CAAG,CAC1BC,EAAE,CAAEC,MAAM,CAACC,UAAU,CAAC,CAAC,CACvBC,IAAI,CAAER,IAAI,CAACQ,IAAI,CACfC,IAAI,CAAET,IAAI,CAACS,IAAI,CACfC,IAAI,CAAEV,IAAI,CAACU,IAAI,CACfC,UAAU,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACpCZ,aAAa,CAAEA,aAAa,CAACA,aAAa,CAC1Ca,QAAQ,CAAE,CACRN,IAAI,CAAER,IAAI,CAACQ,IAAI,CACfO,YAAY,CAAEf,IAAI,CAACQ,IAAI,CACvBC,IAAI,CAAET,IAAI,CAACS,IAAI,CACfO,QAAQ,CAAEhB,IAAI,CAACS,IAAI,CACnBC,IAAI,CAAEV,IAAI,CAACU,IAAI,CACfO,YAAY,CAAEjB,IAAI,CAACiB,YAAY,CAC/B;AACAf,GAAG,CAAEA,GAAI;AACX,CACF,CAAC,CAEDN,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEO,OAAO,CAAC,CAEzC;AACA,KAAM,CAAAc,YAAY,CAAGhC,SAAS,CAACkB,OAAO,CAAC,CAEvC;AACAf,QAAQ,CAAC6B,YAAY,CAAC,CAEtB;AACAzB,kBAAkB,CAAC,KAAK,CAAC,CAEzBjB,KAAK,CAAC2C,OAAO,CAAC,6BAA6B,CAAC,CAC5C,MAAO,CAAAf,OAAO,CAChB,CAAE,MAAON,KAAK,CAAE,CACdF,OAAO,CAACE,KAAK,CAAC,qBAAqB,CAAEA,KAAK,CAAC,CAC3C,KAAM,CAAAA,KAAK,CACb,CAAC,OAAS,CACRP,cAAc,CAAC,KAAK,CAAC,CACvB,CACF,CAAC,CAED,KAAM,CAAA6B,gBAAgB,CAAG,KAAO,CAAAC,MAAc,EAAK,CACjD,GAAI,CAACrC,aAAa,CAAE,OAEpB,GAAI,CAACsC,MAAM,CAACC,OAAO,CAAC,0EAA0E,CAAC,CAAE,CAC/F,OACF,CAEA,GAAI,CACF;AACApC,gBAAgB,CAACkC,MAAM,CAAC,CAExB;AACAhC,QAAQ,CAACmC,SAAS,EAAIA,SAAS,CAACC,MAAM,CAACzB,IAAI,EAAIA,IAAI,CAACK,EAAE,GAAKgB,MAAM,CAAC,CAAC,CAErE,CAAE,MAAOvB,KAAK,CAAE,CACdF,OAAO,CAACE,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAChD,CACF,CAAC,CAED,mBACEjB,KAAA,QAAK6C,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxB9C,KAAA,QAAK6C,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDhD,IAAA,OAAI+C,SAAS,CAAC,+BAA+B,CAAAC,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC3D9C,KAAA,WACE4B,IAAI,CAAC,QAAQ,CACbmB,OAAO,CAAEA,CAAA,GAAMnC,kBAAkB,CAAC,IAAI,CAAE,CACxCiC,SAAS,CAAC,aAAa,CAAAC,QAAA,eAEvBhD,IAAA,CAACJ,QAAQ,EAACmD,SAAS,CAAC,oBAAoB,CAAE,CAAC,cAE7C,EAAQ,CAAC,EACN,CAAC,cAEN/C,IAAA,QAAK+C,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnBhD,IAAA,CAACL,QAAQ,EACPc,KAAK,CAAEA,KAAM,CACbyC,QAAQ,CAAET,gBAAiB,CAC5B,CAAC,CACC,CAAC,CAGL5B,eAAe,eACdb,IAAA,QAAK+C,SAAS,CAAC,oCAAoC,CAAAC,QAAA,cACjD9C,KAAA,QAAK6C,SAAS,CAAC,2FAA2F,CAAAC,QAAA,eACxGhD,IAAA,QAAK+C,SAAS,CAAC,kCAAkC,CAAC,cAAY,MAAM,CAAAC,QAAA,cAClEhD,IAAA,QAAK+C,SAAS,CAAC,sCAAsC,CAAM,CAAC,CACzD,CAAC,cAEN/C,IAAA,SAAM+C,SAAS,CAAC,oDAAoD,CAAC,cAAY,MAAM,CAAAC,QAAA,CAAC,QAExF,CAAM,CAAC,cAEP9C,KAAA,QAAK6C,SAAS,CAAC,oLAAoL,CAAAC,QAAA,eACjMhD,IAAA,QAAK+C,SAAS,CAAC,2CAA2C,CAAAC,QAAA,cACxDhD,IAAA,QAAK+C,SAAS,CAAC,wBAAwB,CAAAC,QAAA,cACrC9C,KAAA,QAAK6C,SAAS,CAAC,sDAAsD,CAAAC,QAAA,eACnEhD,IAAA,OAAI+C,SAAS,CAAC,+CAA+C,CAAAC,QAAA,CAAC,aAE9D,CAAI,CAAC,cACLhD,IAAA,QAAK+C,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnBhD,IAAA,CAACN,UAAU,EACTyD,QAAQ,CAAE/B,gBAAiB,CAC3BT,WAAW,CAAEA,WAAY,CAC1B,CAAC,CACC,CAAC,EACH,CAAC,CACH,CAAC,CACH,CAAC,cACNX,IAAA,QAAK+C,SAAS,CAAC,2DAA2D,CAAAC,QAAA,cACxEhD,IAAA,WACE8B,IAAI,CAAC,QAAQ,CACbmB,OAAO,CAAEA,CAAA,GAAMnC,kBAAkB,CAAC,KAAK,CAAE,CACzCiC,SAAS,CAAC,eAAe,CACzBK,QAAQ,CAAEzC,WAAY,CAAAqC,QAAA,CACvB,OAED,CAAQ,CAAC,CACN,CAAC,EACH,CAAC,EACH,CAAC,CACH,CACN,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAA7C,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}