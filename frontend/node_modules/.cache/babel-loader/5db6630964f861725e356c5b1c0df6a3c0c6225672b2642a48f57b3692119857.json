{"ast":null,"code":"import _objectSpread from\"F:/Final Year Project/Project Implementation/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useCallback}from'react';import{ethers}from'ethers';import{BSCIAMAuthABI}from'../config/abi';import contracts from'../config/contracts.json';import{idbPutEncrypted,idbGetEncrypted}from'../utils/cryptoUtils';import{jsx as _jsx}from\"react/jsx-runtime\";const WalletContext=/*#__PURE__*/createContext(undefined);export const WalletProvider=_ref=>{let{children}=_ref;const[wallet,setWallet]=useState({isConnected:false,account:null,chainId:null,balance:null});const[userProfile,setUserProfile]=useState(null);const[isRegistered,setIsRegistered]=useState(false);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(null);const[encryptionKey,setEncryptionKey]=useState(null);const[provider,setProvider]=useState(null);const[signer,setSigner]=useState(null);// Initialize encryption key for the current account\nconst initializeEncryptionKey=useCallback(account=>{const key=localStorage.getItem(\"encryption_key_\".concat(account));if(!key)return null;setEncryptionKey(key);return key;},[]);// Get stored files for the current user\nconst getStoredFiles=useCallback(()=>{if(!wallet.account)return[];const files=localStorage.getItem(\"files_\".concat(wallet.account));return files?JSON.parse(files):[];},[wallet.account]);// Activity helpers\nconst getActivities=useCallback(()=>{if(!wallet.account)return[];const raw=localStorage.getItem(\"activities_\".concat(wallet.account));return raw?JSON.parse(raw):[];},[wallet.account]);const saveActivities=useCallback(activities=>{if(!wallet.account)return;localStorage.setItem(\"activities_\".concat(wallet.account),JSON.stringify(activities));},[wallet.account]);const bumpReputation=useCallback(()=>{if(!wallet.account)return;const userRaw=localStorage.getItem(\"user_\".concat(wallet.account));if(!userRaw)return;const updated=_objectSpread(_objectSpread({},JSON.parse(userRaw)),{},{reputationScore:(JSON.parse(userRaw).reputationScore||0)+10});localStorage.setItem(\"user_\".concat(wallet.account),JSON.stringify(updated));setUserProfile(updated);},[wallet.account]);const recordActivity=useCallback((type,details)=>{if(!wallet.account)return;const activities=getActivities();const entry={id:crypto.randomUUID(),type,details,timestamp:new Date().toISOString()};const updated=[entry,...activities].slice(0,100);saveActivities(updated);bumpReputation();},[wallet.account,getActivities,saveActivities,bumpReputation]);// Get the user's encryption key\nconst getEncryptionKey=useCallback(()=>{if(!wallet.account)return null;return localStorage.getItem(\"encryption_key_\".concat(wallet.account));},[wallet.account]);// Store a new file\nconst storeFile=useCallback(file=>{if(!wallet.account){throw new Error('No wallet connected');}const files=getStoredFiles();// Check if file with same name already exists\nconst existingFileIndex=files.findIndex(f=>f.name===file.name&&f.uploadedAt===file.uploadedAt);let updatedFiles;if(existingFileIndex>=0){// Update existing file\nupdatedFiles=[...files];updatedFiles[existingFileIndex]=file;}else{// Add new file\nupdatedFiles=[...files,file];}localStorage.setItem(\"files_\".concat(wallet.account),JSON.stringify(updatedFiles));// Record upload activity\ntry{recordActivity('upload',file.name);}catch(_unused){}return updatedFiles;},[wallet.account,getStoredFiles,recordActivity]);// Delete a file\nconst deleteStoredFile=useCallback(fileId=>{if(!wallet.account){throw new Error('No wallet connected');}const files=getStoredFiles();const fileToDelete=files.find(f=>f.id===fileId);if(!fileToDelete){throw new Error('File not found');}const updatedFiles=files.filter(file=>file.id!==fileId);localStorage.setItem(\"files_\".concat(wallet.account),JSON.stringify(updatedFiles));try{recordActivity('delete',fileToDelete.name);}catch(_unused2){}return updatedFiles;},[wallet.account,getStoredFiles,recordActivity]);// Get the current encryption key\nconst getEncryptionKeyFromState=useCallback(()=>{return encryptionKey;},[encryptionKey]);// Upload a file with encryption\nconst uploadFile=useCallback(async(file,encryptedData,key)=>{if(!wallet.account){throw new Error('No wallet connected');}if(!key){throw new Error('Encryption key is required');}if(!encryptedData){throw new Error('No encrypted data provided');}try{setIsLoading(true);const storedFiles=getStoredFiles();// Check if file with same name already exists\nconst fileExists=storedFiles.some(f=>{var _f$metadata;return f.name===file.name&&((_f$metadata=f.metadata)===null||_f$metadata===void 0?void 0:_f$metadata.lastModified)===file.lastModified;});if(fileExists){throw new Error('A file with this name already exists');}const newFile={id:crypto.randomUUID(),name:file.name,type:file.type,size:file.size,uploadedAt:new Date().toISOString(),encryptedData:'',metadata:{name:file.name,originalName:file.name,type:file.type,mimeType:file.type,size:file.size,lastModified:file.lastModified}};// Persist the encrypted payload in IndexedDB (non-volatile)\nawait idbPutEncrypted(newFile.id,encryptedData.encryptedData||encryptedData);const updatedFiles=[...storedFiles,newFile];localStorage.setItem(\"files_\".concat(wallet.account),JSON.stringify(updatedFiles));return newFile;}catch(error){console.error('Error uploading file:',error);throw error;}finally{setIsLoading(false);}},[wallet.account,getStoredFiles]);// Check if user is already registered\nconst checkRegistration=useCallback(async account=>{try{if(!account)return false;const userData=localStorage.getItem(\"user_\".concat(account));const encryptionKey=localStorage.getItem(\"encryption_key_\".concat(account));if(userData&&encryptionKey){const userProfile=JSON.parse(userData);setUserProfile(userProfile);setEncryptionKey(encryptionKey);setIsRegistered(true);return true;}// Clear any partial data if registration is not complete\nlocalStorage.removeItem(\"user_\".concat(account));localStorage.removeItem(\"encryption_key_\".concat(account));return false;}catch(error){console.error('Error checking registration:',error);setError('Failed to check user registration.');return false;}},[initializeEncryptionKey]);// Validate encryption key against the stored key\nconst validateEncryptionKey=useCallback(key=>{if(!wallet.account)return false;const storedKey=localStorage.getItem(\"encryption_key_\".concat(wallet.account));return key===storedKey;},[wallet.account]);// Disconnect wallet\nconst disconnectWallet=useCallback(()=>{// Note: We don't clear localStorage here to preserve user data for future logins\nsetWallet({isConnected:false,account:null,chainId:null,balance:null});setUserProfile(null);setIsRegistered(false);setIsLoading(false);setError(null);setProvider(null);setSigner(null);},[]);// Connect wallet\nconst connectWallet=useCallback(async()=>{if(typeof window.ethereum==='undefined'){setError('Please install MetaMask!');return;}try{setIsLoading(true);const provider=new ethers.BrowserProvider(window.ethereum);const signer=await provider.getSigner();const address=await signer.getAddress();const network=await provider.getNetwork();setProvider(provider);setSigner(signer);setWallet({isConnected:true,account:address,chainId:network.chainId.toString(),balance:null});setError(null);// Check if user is registered\nconst registered=await checkRegistration(address);if(registered){try{recordActivity('login','Wallet connected');}catch(_unused3){}}}catch(err){console.error('Error connecting wallet:',err);setError('Failed to connect wallet. Please try again.');}finally{setIsLoading(false);}},[checkRegistration]);// Register a new user\nconst registerUser=useCallback(async function(username){let email=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';if(!wallet.account){return{success:false,message:'No wallet connected'};}try{setIsLoading(true);// Generate a secure encryption key for the user\nconst key=Array.from(window.crypto.getRandomValues(new Uint8Array(32))).map(b=>b.toString(16).padStart(2,'0')).join('');// Create user profile according to UserProfile interface\nconst newUserProfile={walletAddress:wallet.account,username,email,registrationTime:new Date().toISOString(),isActive:true,reputationScore:0,accessRoles:['user']};// Store user data and encryption key in localStorage\nlocalStorage.setItem(\"user_\".concat(wallet.account),JSON.stringify(newUserProfile));localStorage.setItem(\"encryption_key_\".concat(wallet.account),key);// Update state\nsetUserProfile(newUserProfile);setIsRegistered(true);setEncryptionKey(key);// Seed activities with registration considered as login\ntry{const initialActivities=[{id:crypto.randomUUID(),type:'login',details:'Registered and logged in',timestamp:new Date().toISOString()}];localStorage.setItem(\"activities_\".concat(wallet.account),JSON.stringify(initialActivities));}catch(_unused4){}// Copy the encryption key to clipboard\ntry{await navigator.clipboard.writeText(key);// Also alert the user with the generated key\ntry{window.alert(\"Registration successful!\\n\\nYour encryption key (copy kept in clipboard):\\n\".concat(key,\"\\n\\nStore this key safely; it is required for all file operations.\"));}catch(e){// no-op if alert blocked\n}return{success:true,message:'Registration successful! Your encryption key has been copied to clipboard. Please keep it safe!',encryptionKey:key};}catch(clipboardError){console.error('Failed to copy encryption key:',clipboardError);try{window.alert(\"Registration successful!\\n\\nPlease copy and save your encryption key:\\n\".concat(key));}catch(e){// no-op\n}return{success:true,message:\"Registration successful! Please copy and save your encryption key: \".concat(key),encryptionKey:key};}}catch(error){console.error('Registration failed:',error);return{success:false,message:error instanceof Error?error.message:'Registration failed. Please try again.'};}finally{setIsLoading(false);}},[wallet.account]);const updateUsername=useCallback(newUsername=>{if(!wallet.account||!userProfile)return;const updated=_objectSpread(_objectSpread({},userProfile),{},{username:newUsername});localStorage.setItem(\"user_\".concat(wallet.account),JSON.stringify(updated));setUserProfile(updated);},[wallet.account,userProfile]);const getRecentActivities=useCallback(function(){let limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;return getActivities().slice(0,limit);},[getActivities]);const getAllActivities=useCallback(()=>{return getActivities();},[getActivities]);const getAllUsers=useCallback(async()=>{const users=[];// Local users (same browser)\nfor(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);if(!key)continue;if(key.startsWith('user_')){try{const parsed=JSON.parse(localStorage.getItem(key)||'null');if(parsed&&parsed.walletAddress)users.push(parsed);}catch(_unused5){}}}// Attempt to augment with on-chain users if connected and configured\ntry{var _contracts$auth;if(provider&&contracts!==null&&contracts!==void 0&&(_contracts$auth=contracts.auth)!==null&&_contracts$auth!==void 0&&_contracts$auth.address){// Heuristic: scan recent UserRegistered events for a small block window\nconst ethProvider=provider;const signer=await ethProvider.getSigner();const contract=new ethers.Contract(contracts.auth.address,BSCIAMAuthABI,signer);const currentBlock=await ethProvider.getBlockNumber();const fromBlock=currentBlock-5000>0?currentBlock-5000:0;// last ~5000 blocks\n// v6 queryFilter across fragments requires passing event name\nconst events=await contract.queryFilter('UserRegistered',fromBlock,currentBlock);for(const ev of events){const args=ev.args;const user=(args===null||args===void 0?void 0:args.user)||(args===null||args===void 0?void 0:args[0]);if(!user)continue;try{const p=await contract.getUserProfile(user);const profile={walletAddress:p.walletAddress,username:p.username,email:p.email,registrationTime:new Date(Number(p.registrationTime)*1000).toISOString(),isActive:Boolean(p.isActive),reputationScore:Number(p.reputationScore),accessRoles:Array.from(p.accessRoles||[])};if(!users.find(u=>u.walletAddress.toLowerCase()===profile.walletAddress.toLowerCase())){users.push(profile);}}catch(_unused6){}}}}catch(e){console.warn('On-chain user fetch skipped or failed:',e);}return users;},[provider]);const value={wallet,isRegistered,userProfile,isLoading,error,encryptionKey,connectWallet,disconnectWallet,registerUser,getEncryptionKey:getEncryptionKeyFromState,validateEncryptionKey,getStoredFiles,storeFile,uploadFile,downloadFile:async(fileId,key)=>{console.log('Downloading file:',fileId,'with key:',key);const files=getStoredFiles();const file=files.find(f=>f.id===fileId);if(!file)throw new Error('File not found');const encryptedPayload=await idbGetEncrypted(fileId);if(!encryptedPayload)throw new Error('No encrypted data found.');// The UI path currently uses decryptFile directly; this method is a placeholder\nreturn;},deleteStoredFile,getRecentActivities,getAllActivities,recordActivity,updateUsername,getAllUsers};return/*#__PURE__*/_jsx(WalletContext.Provider,{value:value,children:children});};export const useWallet=()=>{const context=useContext(WalletContext);if(context===undefined){throw new Error('useWallet must be used within a WalletProvider');}return context;};// Extend Window interface for TypeScript","map":{"version":3,"names":["React","createContext","useContext","useState","useCallback","ethers","BSCIAMAuthABI","contracts","idbPutEncrypted","idbGetEncrypted","jsx","_jsx","WalletContext","undefined","WalletProvider","_ref","children","wallet","setWallet","isConnected","account","chainId","balance","userProfile","setUserProfile","isRegistered","setIsRegistered","isLoading","setIsLoading","error","setError","encryptionKey","setEncryptionKey","provider","setProvider","signer","setSigner","initializeEncryptionKey","key","localStorage","getItem","concat","getStoredFiles","files","JSON","parse","getActivities","raw","saveActivities","activities","setItem","stringify","bumpReputation","userRaw","updated","_objectSpread","reputationScore","recordActivity","type","details","entry","id","crypto","randomUUID","timestamp","Date","toISOString","slice","getEncryptionKey","storeFile","file","Error","existingFileIndex","findIndex","f","name","uploadedAt","updatedFiles","_unused","deleteStoredFile","fileId","fileToDelete","find","filter","_unused2","getEncryptionKeyFromState","uploadFile","encryptedData","storedFiles","fileExists","some","_f$metadata","metadata","lastModified","newFile","size","originalName","mimeType","console","checkRegistration","userData","removeItem","validateEncryptionKey","storedKey","disconnectWallet","connectWallet","window","ethereum","BrowserProvider","getSigner","address","getAddress","network","getNetwork","toString","registered","_unused3","err","registerUser","username","email","arguments","length","success","message","Array","from","getRandomValues","Uint8Array","map","b","padStart","join","newUserProfile","walletAddress","registrationTime","isActive","accessRoles","initialActivities","_unused4","navigator","clipboard","writeText","alert","e","clipboardError","updateUsername","newUsername","getRecentActivities","limit","getAllActivities","getAllUsers","users","i","startsWith","parsed","push","_unused5","_contracts$auth","auth","ethProvider","contract","Contract","currentBlock","getBlockNumber","fromBlock","events","queryFilter","ev","args","user","p","getUserProfile","profile","Number","Boolean","u","toLowerCase","_unused6","warn","value","downloadFile","log","encryptedPayload","Provider","useWallet","context"],"sources":["F:/Final Year Project/Project Implementation/frontend/src/context/WalletContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useCallback, ReactNode } from 'react';\nimport { ethers } from 'ethers';\nimport { BSCIAMAuthABI } from '../config/abi';\nimport contracts from '../config/contracts.json';\nimport { StoredFile } from '../types';\nimport { UserProfile } from '../types';\nimport { idbPutEncrypted, idbGetEncrypted } from '../utils/cryptoUtils';\n\ndeclare global {\n  interface Window {\n    ethereum?: any;\n  }\n}\n\ninterface WalletState {\n  isConnected: boolean;\n  account: string | null;\n  chainId: string | null;\n  balance: string | null;\n}\n\ninterface WalletContextType {\n  // Wallet state\n  wallet: WalletState;\n  isRegistered: boolean;\n  userProfile: UserProfile | null;\n  isLoading: boolean;\n  error: string | null;\n  encryptionKey: string | null;\n  \n  // Wallet methods\n  connectWallet: () => Promise<void>;\n  disconnectWallet: () => void;\n  \n  // User methods\n  registerUser: (username: string, email?: string) => Promise<{ \n    success: boolean; \n    message: string; \n    encryptionKey?: string \n  }>;\n  \n  // Encryption methods\n  getEncryptionKey: () => string | null;\n  validateEncryptionKey: (key: string) => boolean;\n  \n  // File methods\n  getStoredFiles: () => StoredFile[];\n  storeFile: (file: StoredFile) => StoredFile[];\n  uploadFile: (file: File, encryptedData: any, key: string) => Promise<StoredFile>;\n  downloadFile: (fileId: string, key: string) => Promise<void>;\n  deleteStoredFile: (fileId: string) => void;\n\n  // Activity & profile\n  getRecentActivities: (limit?: number) => Array<{ id: string; type: string; details?: string; timestamp: string }>;\n  getAllActivities: () => Array<{ id: string; type: string; details?: string; timestamp: string }>;\n  recordActivity: (type: 'login' | 'upload' | 'download' | 'delete', details?: string) => void;\n  updateUsername: (newUsername: string) => void;\n  getAllUsers: () => Promise<UserProfile[]>;\n}\n\nconst WalletContext = createContext<WalletContextType | undefined>(undefined);\n\ninterface WalletProviderProps {\n  children: ReactNode;\n}\n\nexport const WalletProvider: React.FC<WalletProviderProps> = ({ children }) => {\n  const [wallet, setWallet] = useState<WalletState>({\n    isConnected: false,\n    account: null,\n    chainId: null,\n    balance: null,\n  });\n  \n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [isRegistered, setIsRegistered] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [encryptionKey, setEncryptionKey] = useState<string | null>(null);\n\n  const [provider, setProvider] = useState<ethers.BrowserProvider | null>(null);\n  const [signer, setSigner] = useState<ethers.JsonRpcSigner | null>(null);\n\n  // Initialize encryption key for the current account\n  const initializeEncryptionKey = useCallback((account: string): string | null => {\n    const key = localStorage.getItem(`encryption_key_${account}`);\n    if (!key) return null;\n    setEncryptionKey(key);\n    return key;\n  }, []);\n\n  // Get stored files for the current user\n  const getStoredFiles = useCallback((): StoredFile[] => {\n    if (!wallet.account) return [];\n    const files = localStorage.getItem(`files_${wallet.account}`);\n    return files ? JSON.parse(files) : [];\n  }, [wallet.account]);\n\n  // Activity helpers\n  const getActivities = useCallback((): Array<{ id: string; type: string; details?: string; timestamp: string }> => {\n    if (!wallet.account) return [];\n    const raw = localStorage.getItem(`activities_${wallet.account}`);\n    return raw ? JSON.parse(raw) : [];\n  }, [wallet.account]);\n\n  const saveActivities = useCallback((activities: Array<{ id: string; type: string; details?: string; timestamp: string }>) => {\n    if (!wallet.account) return;\n    localStorage.setItem(`activities_${wallet.account}`, JSON.stringify(activities));\n  }, [wallet.account]);\n\n  const bumpReputation = useCallback(() => {\n    if (!wallet.account) return;\n    const userRaw = localStorage.getItem(`user_${wallet.account}`);\n    if (!userRaw) return;\n    const updated: UserProfile = { ...JSON.parse(userRaw), reputationScore: (JSON.parse(userRaw).reputationScore || 0) + 10 };\n    localStorage.setItem(`user_${wallet.account}`, JSON.stringify(updated));\n    setUserProfile(updated);\n  }, [wallet.account]);\n\n  const recordActivity = useCallback((type: 'login' | 'upload' | 'download' | 'delete', details?: string) => {\n    if (!wallet.account) return;\n    const activities = getActivities();\n    const entry = { id: crypto.randomUUID(), type, details, timestamp: new Date().toISOString() };\n    const updated = [entry, ...activities].slice(0, 100);\n    saveActivities(updated);\n    bumpReputation();\n  }, [wallet.account, getActivities, saveActivities, bumpReputation]);\n\n  // Get the user's encryption key\n  const getEncryptionKey = useCallback((): string | null => {\n    if (!wallet.account) return null;\n    return localStorage.getItem(`encryption_key_${wallet.account}`);\n  }, [wallet.account]);\n\n  // Store a new file\n  const storeFile = useCallback((file: StoredFile) => {\n    if (!wallet.account) {\n      throw new Error('No wallet connected');\n    }\n    \n    const files = getStoredFiles();\n    // Check if file with same name already exists\n    const existingFileIndex = files.findIndex(f => f.name === file.name && f.uploadedAt === file.uploadedAt);\n    \n    let updatedFiles;\n    if (existingFileIndex >= 0) {\n      // Update existing file\n      updatedFiles = [...files];\n      updatedFiles[existingFileIndex] = file;\n    } else {\n      // Add new file\n      updatedFiles = [...files, file];\n    }\n    \n    localStorage.setItem(\n      `files_${wallet.account}`, \n      JSON.stringify(updatedFiles)\n    );\n    // Record upload activity\n    try { recordActivity('upload', file.name); } catch {}\n    return updatedFiles;\n  }, [wallet.account, getStoredFiles, recordActivity]);\n\n  // Delete a file\n  const deleteStoredFile = useCallback((fileId: string) => {\n    if (!wallet.account) {\n      throw new Error('No wallet connected');\n    }\n    \n    const files = getStoredFiles();\n    const fileToDelete = files.find(f => f.id === fileId);\n    \n    if (!fileToDelete) {\n      throw new Error('File not found');\n    }\n    \n    const updatedFiles = files.filter(file => file.id !== fileId);\n    \n    localStorage.setItem(\n      `files_${wallet.account}`, \n      JSON.stringify(updatedFiles)\n    );\n    try { recordActivity('delete', fileToDelete.name); } catch {}\n    return updatedFiles;\n  }, [wallet.account, getStoredFiles, recordActivity]);\n\n  // Get the current encryption key\n  const getEncryptionKeyFromState = useCallback((): string | null => {\n    return encryptionKey;\n  }, [encryptionKey]);\n\n  // Upload a file with encryption\n  const uploadFile = useCallback(async (file: File, encryptedData: any, key: string): Promise<StoredFile> => {\n    if (!wallet.account) {\n      throw new Error('No wallet connected');\n    }\n    \n    if (!key) {\n      throw new Error('Encryption key is required');\n    }\n    \n    if (!encryptedData) {\n      throw new Error('No encrypted data provided');\n    }\n    \n    try {\n      setIsLoading(true);\n      const storedFiles = getStoredFiles();\n      \n      // Check if file with same name already exists\n      const fileExists = storedFiles.some(f => \n        f.name === file.name && \n        f.metadata?.lastModified === file.lastModified\n      );\n      \n      if (fileExists) {\n        throw new Error('A file with this name already exists');\n      }\n      \n      const newFile: StoredFile = {\n        id: crypto.randomUUID(),\n        name: file.name,\n        type: file.type,\n        size: file.size,\n        uploadedAt: new Date().toISOString(),\n        encryptedData: '',\n        metadata: {\n          name: file.name,\n          originalName: file.name,\n          type: file.type,\n          mimeType: file.type,\n          size: file.size,\n          lastModified: file.lastModified\n        }\n      };\n      // Persist the encrypted payload in IndexedDB (non-volatile)\n      await idbPutEncrypted(newFile.id, encryptedData.encryptedData || encryptedData);\n      const updatedFiles = [...storedFiles, newFile];\n      localStorage.setItem(`files_${wallet.account}`, JSON.stringify(updatedFiles));\n      \n      return newFile;\n    } catch (error) {\n      console.error('Error uploading file:', error);\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [wallet.account, getStoredFiles]);\n\n  // Check if user is already registered\n  const checkRegistration = useCallback(async (account: string): Promise<boolean> => {\n    try {\n      if (!account) return false;\n      \n      const userData = localStorage.getItem(`user_${account}`);\n      const encryptionKey = localStorage.getItem(`encryption_key_${account}`);\n      \n      if (userData && encryptionKey) {\n        const userProfile = JSON.parse(userData) as UserProfile;\n        setUserProfile(userProfile);\n        setEncryptionKey(encryptionKey);\n        setIsRegistered(true);\n        return true;\n      }\n      \n      // Clear any partial data if registration is not complete\n      localStorage.removeItem(`user_${account}`);\n      localStorage.removeItem(`encryption_key_${account}`);\n      return false;\n    } catch (error) {\n      console.error('Error checking registration:', error);\n      setError('Failed to check user registration.');\n      return false;\n    }\n  }, [initializeEncryptionKey]);\n\n  // Validate encryption key against the stored key\n  const validateEncryptionKey = useCallback((key: string): boolean => {\n    if (!wallet.account) return false;\n    const storedKey = localStorage.getItem(`encryption_key_${wallet.account}`);\n    return key === storedKey;\n  }, [wallet.account]);\n\n  // Disconnect wallet\n  const disconnectWallet = useCallback(() => {\n    // Note: We don't clear localStorage here to preserve user data for future logins\n    setWallet({\n      isConnected: false,\n      account: null,\n      chainId: null,\n      balance: null,\n    });\n    setUserProfile(null);\n    setIsRegistered(false);\n    setIsLoading(false);\n    setError(null);\n    setProvider(null);\n    setSigner(null);\n  }, []);\n\n  // Connect wallet\n  const connectWallet = useCallback(async () => {\n    if (typeof window.ethereum === 'undefined') {\n      setError('Please install MetaMask!');\n      return;\n    }\n\n    try {\n      setIsLoading(true);\n      const provider = new ethers.BrowserProvider(window.ethereum);\n      const signer = await provider.getSigner();\n      const address = await signer.getAddress();\n      const network = await provider.getNetwork();\n      \n      setProvider(provider);\n      setSigner(signer);\n      setWallet({\n        isConnected: true,\n        account: address,\n        chainId: network.chainId.toString(),\n        balance: null,\n      });\n      setError(null);\n\n      // Check if user is registered\n      const registered = await checkRegistration(address);\n      if (registered) {\n        try { recordActivity('login', 'Wallet connected'); } catch {}\n      }\n    } catch (err) {\n      console.error('Error connecting wallet:', err);\n      setError('Failed to connect wallet. Please try again.');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [checkRegistration]);\n\n  // Register a new user\n  const registerUser = useCallback(async (username: string, email: string = '') => {\n    if (!wallet.account) {\n      return { success: false, message: 'No wallet connected' };\n    }\n\n    try {\n      setIsLoading(true);\n      \n      // Generate a secure encryption key for the user\n      const key = Array.from(window.crypto.getRandomValues(new Uint8Array(32)))\n        .map(b => b.toString(16).padStart(2, '0'))\n        .join('');\n      \n      // Create user profile according to UserProfile interface\n      const newUserProfile: UserProfile = {\n        walletAddress: wallet.account,\n        username,\n        email,\n        registrationTime: new Date().toISOString(),\n        isActive: true,\n        reputationScore: 0,\n        accessRoles: ['user']\n      };\n\n      // Store user data and encryption key in localStorage\n      localStorage.setItem(`user_${wallet.account}`, JSON.stringify(newUserProfile));\n      localStorage.setItem(`encryption_key_${wallet.account}`, key);\n      \n      // Update state\n      setUserProfile(newUserProfile);\n      setIsRegistered(true);\n      setEncryptionKey(key);\n\n      // Seed activities with registration considered as login\n      try {\n        const initialActivities = [{ id: crypto.randomUUID(), type: 'login', details: 'Registered and logged in', timestamp: new Date().toISOString() }];\n        localStorage.setItem(`activities_${wallet.account}`, JSON.stringify(initialActivities));\n      } catch {}\n      \n      // Copy the encryption key to clipboard\n      try {\n        await navigator.clipboard.writeText(key);\n        // Also alert the user with the generated key\n        try {\n          window.alert(`Registration successful!\\n\\nYour encryption key (copy kept in clipboard):\\n${key}\\n\\nStore this key safely; it is required for all file operations.`);\n        } catch (e) {\n          // no-op if alert blocked\n        }\n        return { \n          success: true, \n          message: 'Registration successful! Your encryption key has been copied to clipboard. Please keep it safe!',\n          encryptionKey: key\n        };\n      } catch (clipboardError) {\n        console.error('Failed to copy encryption key:', clipboardError);\n        try {\n          window.alert(`Registration successful!\\n\\nPlease copy and save your encryption key:\\n${key}`);\n        } catch (e) {\n          // no-op\n        }\n        return { \n          success: true, \n          message: `Registration successful! Please copy and save your encryption key: ${key}`,\n          encryptionKey: key\n        };\n      }\n    } catch (error) {\n      console.error('Registration failed:', error);\n      return { \n        success: false, \n        message: error instanceof Error ? error.message : 'Registration failed. Please try again.'\n      };\n    } finally {\n      setIsLoading(false);\n    }\n  }, [wallet.account]);\n\n  const updateUsername = useCallback((newUsername: string) => {\n    if (!wallet.account || !userProfile) return;\n    const updated: UserProfile = { ...userProfile, username: newUsername };\n    localStorage.setItem(`user_${wallet.account}`, JSON.stringify(updated));\n    setUserProfile(updated);\n  }, [wallet.account, userProfile]);\n\n  const getRecentActivities = useCallback((limit: number = 3) => {\n    return getActivities().slice(0, limit);\n  }, [getActivities]);\n\n  const getAllActivities = useCallback(() => {\n    return getActivities();\n  }, [getActivities]);\n\n  const getAllUsers = useCallback(async (): Promise<UserProfile[]> => {\n    const users: UserProfile[] = [];\n    // Local users (same browser)\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (!key) continue;\n      if (key.startsWith('user_')) {\n        try {\n          const parsed = JSON.parse(localStorage.getItem(key) || 'null');\n          if (parsed && parsed.walletAddress) users.push(parsed);\n        } catch {}\n      }\n    }\n\n    // Attempt to augment with on-chain users if connected and configured\n    try {\n      if (provider && contracts?.auth?.address) {\n        // Heuristic: scan recent UserRegistered events for a small block window\n        const ethProvider = provider as unknown as ethers.BrowserProvider;\n        const signer = await ethProvider.getSigner();\n        const contract = new ethers.Contract(contracts.auth.address, BSCIAMAuthABI, signer);\n        const currentBlock = await ethProvider.getBlockNumber();\n        const fromBlock = currentBlock - 5000 > 0 ? currentBlock - 5000 : 0; // last ~5000 blocks\n        // v6 queryFilter across fragments requires passing event name\n        const events = await contract.queryFilter('UserRegistered', fromBlock, currentBlock);\n        for (const ev of events as any[]) {\n          const args: any = (ev as any).args;\n          const user: string = args?.user || args?.[0];\n          if (!user) continue;\n          try {\n            const p: any = await contract.getUserProfile(user);\n            const profile: UserProfile = {\n              walletAddress: p.walletAddress,\n              username: p.username,\n              email: p.email,\n              registrationTime: new Date(Number(p.registrationTime) * 1000).toISOString(),\n              isActive: Boolean(p.isActive),\n              reputationScore: Number(p.reputationScore),\n              accessRoles: Array.from(p.accessRoles || [])\n            };\n            if (!users.find(u => u.walletAddress.toLowerCase() === profile.walletAddress.toLowerCase())) {\n              users.push(profile);\n            }\n          } catch {}\n        }\n      }\n    } catch (e) {\n      console.warn('On-chain user fetch skipped or failed:', e);\n    }\n\n    return users;\n  }, [provider]);\n\n  const value: WalletContextType = {\n    wallet,\n    isRegistered,\n    userProfile,\n    isLoading,\n    error,\n    encryptionKey,\n    connectWallet,\n    disconnectWallet,\n    registerUser,\n    getEncryptionKey: getEncryptionKeyFromState,\n    validateEncryptionKey,\n    getStoredFiles,\n    storeFile,\n    uploadFile,\n    downloadFile: async (fileId: string, key: string) => {\n      console.log('Downloading file:', fileId, 'with key:', key);\n      const files = getStoredFiles();\n      const file = files.find(f => f.id === fileId);\n      if (!file) throw new Error('File not found');\n      const encryptedPayload = await idbGetEncrypted(fileId);\n      if (!encryptedPayload) throw new Error('No encrypted data found.');\n      // The UI path currently uses decryptFile directly; this method is a placeholder\n      return;\n    },\n    deleteStoredFile,\n    getRecentActivities,\n    getAllActivities,\n    recordActivity,\n    updateUsername,\n    getAllUsers,\n  };\n\n  return (\n    <WalletContext.Provider value={value}>\n      {children}\n    </WalletContext.Provider>\n  );\n};\n\nexport const useWallet = (): WalletContextType => {\n  const context = useContext(WalletContext);\n  if (context === undefined) {\n    throw new Error('useWallet must be used within a WalletProvider');\n  }\n  return context;\n};\n\n// Extend Window interface for TypeScript\ndeclare global {\n  interface Window {\n    ethereum?: any;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}